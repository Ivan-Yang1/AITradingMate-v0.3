# AI Trading Mate - 需求文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 项目名称 | AI Trading Mate |
| 文档版本 | v1.0 |
| 创建日期 | 2026-02-09 |
| 文档类型 | 需求规格说明书 (SRS) |

## 1. 引言

### 1.1 文档目的
本文档详细描述了 AI Trading Mate 平台的功能需求、非功能性需求和系统约束，为开发团队提供明确的实现指导，为测试团队提供验收标准。

### 1.2 项目背景
AI Trading Mate 是一个集成市场数据和AI分析的交易助手平台，旨在为投资者提供实时股票分析、技术指标、K线图表和AI生成的投资见解。平台整合了来自Tushare和AKShare等数据源的市场数据，增强交易决策和数据可视化。

### 1.3 适用范围
本文档适用于 AI Trading Mate 平台 v1.0 版本的开发、测试和部署。

### 1.4 术语定义
| 术语 | 定义 |
|------|------|
| K线图 | 蜡烛图，用于显示股票价格走势的图表 |
| 技术指标 | 基于价格和成交量计算的分析指标 |
| OAuth | 开放授权协议，用于第三方登录 |
| API | 应用程序编程接口 |
| 缓存 | 临时存储数据以提高访问速度的机制 |

## 2. 总体描述

### 2.1 产品概述
AI Trading Mate 是一个基于Web的AI驱动交易助手平台，主要功能包括：
- 用户认证与管理
- 实时股票数据获取与展示
- K线图表与技术指标分析
- AI驱动的股票分析和投资建议
- 自选股管理
- 交易脚本生成与监控
- 系统缓存与配置管理

### 2.2 用户特征
| 用户类型 | 描述 | 主要需求 |
|----------|------|----------|
| 个人投资者 | 普通股票投资者，希望获得AI辅助的投资建议 | 股票分析、投资建议、自选股管理 |
| 专业交易员 | 专业股票交易员，需要高级分析工具 | 实时数据、技术指标、交易脚本 |
| 系统管理员 | 负责系统维护和配置 | 用户管理、系统配置、监控 |

### 2.3 运行环境
- **客户端**: 支持现代浏览器（Chrome、Firefox、Safari、Edge）
- **服务端**: Linux服务器，Python 3.8+
- **数据库**: PostgreSQL 12+
- **缓存**: Redis 6+
- **网络**: 支持HTTPS协议

### 2.4 设计约束
- 必须使用Auth0进行用户认证
- 必须支持Tushare和AKShare数据源
- 必须使用FastAPI作为后端框架
- 必须使用React作为前端框架
- 必须支持HTTPS协议

## 3. 功能需求

### 3.1 用户认证模块 (F01)

#### F01.1 用户登录
**需求描述**: 支持用户通过GitHub或Google账户登录系统

**输入**: 用户点击GitHub或Google登录按钮

**处理流程**:
1. 用户点击登录按钮
2. 系统重定向到OAuth提供商
3. 用户授权后，提供商返回授权码
4. 系统使用授权码获取用户信息
5. 系统创建或更新用户账户
6. 系统生成JWT令牌
7. 系统重定向到首页并设置认证状态

**输出**: 登录成功，用户进入系统首页

**验收标准**:
- 支持GitHub OAuth 2.0登录
- 支持Google OAuth 2.0登录
- 新用户自动创建账户
- 老用户正常登录
- 登录状态持久化（使用JWT）
- 支持安全登出

**优先级**: P0

---

#### F01.2 用户信息管理
**需求描述**: 用户可以查看和编辑个人信息

**输入**: 用户访问个人信息页面

**处理流程**:
1. 系统验证用户身份
2. 系统从数据库获取用户信息
3. 系统显示用户信息
4. 用户编辑信息并提交
5. 系统验证输入数据
6. 系统更新数据库

**输出**: 用户信息更新成功

**验收标准**:
- 显示用户基本信息（用户名、邮箱、头像）
- 支持编辑用户昵称
- 显示账户创建时间
- 显示最后登录时间
- 数据实时保存

**优先级**: P1

---

### 3.2 市场数据模块 (F02)

#### F02.1 股票搜索
**需求描述**: 用户可以搜索股票并查看搜索结果

**输入**: 用户输入股票代码或名称

**处理流程**:
1. 用户输入搜索关键词
2. 系统调用股票搜索API
3. 系统从数据源获取搜索结果
4. 系统格式化并返回结果
5. 前端显示搜索结果列表

**输出**: 显示匹配的股票列表

**验收标准**:
- 支持按股票代码搜索
- 支持按股票名称搜索
- 显示股票代码、名称、最新价格
- 搜索响应时间 < 2秒
- 支持模糊搜索

**优先级**: P0

---

#### F02.2 K线数据获取
**需求描述**: 获取指定股票的K线数据

**输入**: 用户选择股票和时间周期

**处理流程**:
1. 用户选择股票和时间周期
2. 系统检查缓存中是否有数据
3. 如果缓存命中，直接返回缓存数据
4. 如果缓存未命中，调用数据源API获取数据
5. 系统将数据存入缓存
6. 系统返回K线数据

**输出**: 返回K线数据（时间、开盘价、最高价、最低价、收盘价、成交量）

**验收标准**:
- 支持多种时间周期（1分钟、5分钟、15分钟、30分钟、1小时、日线、周线、月线）
- 数据准确无误
- 支持缓存机制
- 数据更新及时
- 支持批量获取历史数据

**优先级**: P0

---

#### F02.3 实时价格更新
**需求描述**: 实时更新股票价格

**输入**: 系统定时触发或用户手动刷新

**处理流程**:
1. 系统定时调用实时价格API
2. 系统获取最新价格数据
3. 系统更新前端显示
4. 系统更新缓存

**输出**: 前端显示最新价格

**验收标准**:
- 价格更新延迟 < 1秒
- 支持WebSocket推送（可选）
- 支持手动刷新
- 显示涨跌幅和涨跌额

**优先级**: P1

---

#### F02.4 数据源管理
**需求描述**: 管理和切换数据源

**输入**: 用户选择数据源

**处理流程**:
1. 用户选择数据源
2. 系统验证数据源可用性
3. 系统更新当前数据源配置
4. 系统刷新数据

**输出**: 使用新数据源获取数据

**验收标准**:
- 支持Tushare数据源
- 支持AKShare数据源
- 显示当前使用的数据源
- 数据源状态监控
- 切换数据源后数据自动刷新

**优先级**: P1

---

### 3.3 图表展示模块 (F03)

#### F03.1 K线图表渲染
**需求描述**: 渲染股票K线图表

**输入**: K线数据

**处理流程**:
1. 前端接收K线数据
2. 系统使用ECharts渲染图表
3. 系统配置图表样式和交互
4. 系统显示图表

**输出**: 显示交互式K线图表

**验收标准**:
- 支持蜡烛图和线图切换
- 支持图表缩放和平移
- 支持十字准星和提示框
- 图表渲染流畅
- 支持图表截图和导出

**优先级**: P0

---

#### F03.2 技术指标计算与显示
**需求描述**: 计算并显示技术指标

**输入**: 用户选择技术指标

**处理流程**:
1. 用户选择技术指标
2. 系统根据K线数据计算指标
3. 系统将指标数据叠加到图表上
4. 系统更新图表显示

**输出**: 图表上显示技术指标

**验收标准**:
- 支持常用技术指标（MA、MACD、KDJ、RSI、BOLL等）
- 支持自定义指标参数
- 支持多个指标同时显示
- 指标计算准确
- 指标数据实时更新

**优先级**: P1

---

### 3.4 AI分析模块 (F04)

#### F04.1 AI股票分析
**需求描述**: 使用AI模型对股票进行分析

**输入**: 用户选择股票并请求分析

**处理流程**:
1. 用户选择股票并点击分析按钮
2. 系统获取股票基本信息和K线数据
3. 系统调用AI模型API
4. AI模型返回分析结果
5. 系统保存分析历史
6. 系统显示分析结果

**输出**: 显示AI分析报告

**验收标准**:
- 分析包含基本面分析
- 分析包含技术面分析
- 提供投资建议（买入、持有、卖出）
- 提供风险评估
- 分析报告可保存和查看历史
- 分析响应时间 < 10秒

**优先级**: P0

---

#### F04.2 AI聊天助手
**需求描述**: 用户可以与AI助手进行对话

**输入**: 用户输入问题

**处理流程**:
1. 用户输入问题
2. 系统将问题和上下文发送给AI
3. AI返回回答
4. 系统保存对话历史
5. 系统显示回答

**输出**: 显示AI回答

**验收标准**:
- 支持自然语言对话
- 支持上下文理解
- 回复及时（< 5秒）
- 支持多轮对话
- 聊天历史可保存
- 支持Markdown格式输出

**优先级**: P1

---

#### F04.3 AI模型配置
**需求描述**: 用户可以配置AI模型参数

**输入**: 用户输入API密钥和模型参数

**处理流程**:
1. 用户进入AI配置页面
2. 用户输入API密钥和选择模型
3. 系统验证API密钥有效性
4. 系统保存配置
5. 系统测试AI连接

**输出**: 配置保存成功

**验收标准**:
- 支持添加自定义AI API密钥
- 支持选择不同的AI模型
- 支持配置AI参数
- 显示API使用量
- 支持测试AI连接
- 配置加密存储

**优先级**: P2

---

#### F04.4 内置AI模型
**需求描述**: 提供内置AI模型供用户使用

**输入**: 用户选择使用内置模型

**处理流程**:
1. 用户选择使用内置AI模型
2. 系统调用内置AI模型API
3. AI模型返回结果
4. 系统显示结果

**输出**: 显示AI分析结果

**验收标准**:
- 提供内置AI模型选项
- 内置模型开箱即用
- 分析结果准确可靠
- 响应时间合理

**优先级**: P1

---

### 3.5 自选股模块 (F05)

#### F05.1 添加自选股
**需求描述**: 用户可以将股票添加到自选股列表

**输入**: 用户点击添加自选股按钮

**处理流程**:
1. 用户点击添加自选股按钮
2. 系统验证股票是否已在自选股中
3. 系统将股票添加到数据库
4. 系统更新前端显示
5. 系统显示成功提示

**输出**: 股票添加到自选股列表

**验收标准**:
- 支持从搜索结果添加
- 支持从K线图页面添加
- 防止重复添加
- 显示添加成功提示
- 自选股列表实时更新

**优先级**: P0

---

#### F05.2 查看自选股列表
**需求描述**: 用户可以查看自选股列表及其最新价格

**输入**: 用户访问自选股页面

**处理流程**:
1. 用户访问自选股页面
2. 系统从数据库获取自选股列表
3. 系统获取每只股票的最新价格
4. 系统格式化并显示数据

**输出**: 显示自选股列表

**验收标准**:
- 显示股票代码、名称、最新价格、涨跌幅
- 支持按涨跌幅排序
- 支持按添加时间排序
- 数据实时更新
- 支持点击查看详情

**优先级**: P0

---

#### F05.3 移除自选股
**需求描述**: 用户可以从自选股列表中移除股票

**输入**: 用户点击移除按钮

**处理流程**:
1. 用户点击移除按钮
2. 系统显示确认对话框
3. 用户确认移除
4. 系统从数据库删除记录
5. 系统更新前端显示

**输出**: 股票从自选股列表中移除

**验收标准**:
- 移除前显示确认提示
- 移除后列表自动更新
- 支持批量移除

**优先级**: P1

---

### 3.6 交易脚本模块 (F06)

#### F06.1 生成交易脚本
**需求描述**: 基于AI分析生成交易脚本

**输入**: 用户请求生成脚本

**处理流程**:
1. AI分析完成后，系统提供生成脚本选项
2. 用户点击生成脚本
3. 系统根据分析结果生成交易脚本
4. 系统显示脚本内容
5. 用户可以编辑和保存脚本

**输出**: 显示交易脚本

**验收标准**:
- 脚本包含交易逻辑
- 脚本包含风险控制参数
- 脚本可编辑
- 脚本可保存
- 支持脚本模板

**优先级**: P2

---

#### F06.2 脚本监控
**需求描述**: 监控运行中的交易脚本

**输入**: 用户访问脚本监控页面

**处理流程**:
1. 用户访问脚本监控页面
2. 系统获取脚本运行状态
3. 系统显示脚本状态和日志
4. 用户可以控制脚本（暂停、恢复、停止）

**输出**: 显示脚本监控信息

**验收标准**:
- 显示脚本运行状态
- 显示脚本执行日志
- 支持暂停和恢复脚本
- 支持停止脚本
- 显示脚本执行结果统计

**优先级**: P2

---

### 3.7 系统管理模块 (F07)

#### F07.1 缓存管理
**需求描述**: 管理系统缓存

**输入**: 管理员访问缓存管理页面

**处理流程**:
1. 管理员访问缓存管理页面
2. 系统获取缓存统计信息
3. 系统显示缓存使用情况
4. 管理员可以清除缓存

**输出**: 显示缓存管理界面

**验收标准**:
- 显示缓存使用情况
- 支持清除指定缓存
- 支持清除全部缓存
- 显示缓存命中率
- 显示缓存大小

**优先级**: P1

---

#### F07.2 用户设置管理
**需求描述**: 用户可以配置个人偏好设置

**输入**: 用户访问设置页面

**处理流程**:
1. 用户访问设置页面
2. 系统显示当前设置
3. 用户修改设置
4. 系统保存设置

**输出**: 设置保存成功

**验收标准**:
- 支持配置默认数据源
- 支持配置默认K线周期
- 支持配置默认技术指标
- 支持配置通知偏好
- 设置自动保存

**优先级**: P1

---

#### F07.3 API使用限制管理
**需求描述**: 管理API使用限制

**输入**: 管理员访问API管理页面

**处理流程**:
1. 管理员访问API管理页面
2. 系统显示API使用统计
3. 管理员可以设置限制

**输出**: 显示API管理界面

**验收标准**:
- 显示各API的使用量
- 显示API调用次数统计
- 支持设置API调用限制
- 支持查看API调用历史
- 超出限制时显示警告

**优先级**: P2

---

### 3.8 数据存储模块 (F08)

#### F08.1 分析历史存储
**需求描述**: 存储用户的股票分析历史

**输入**: AI分析完成

**处理流程**:
1. AI分析完成
2. 系统将分析结果保存到数据库
3. 系统关联用户和股票信息

**输出**: 分析历史保存成功

**验收标准**:
- 自动保存分析历史
- 支持查看历史记录
- 支持搜索和筛选
- 支持删除历史记录

**优先级**: P1

---

#### F08.2 K线数据存储
**需求描述**: 存储K线数据以供离线查看

**输入**: 用户查看K线图

**处理流程**:
1. 用户查看K线图
2. 系统将K线数据保存到本地存储
3. 系统管理存储空间

**输出**: K线数据保存成功

**验收标准**:
- 自动存储查看过的数据
- 支持离线查看
- 有容量限制
- 支持手动清理
- 显示存储空间使用情况

**优先级**: P2

---

## 4. 非功能性需求

### 4.1 性能需求

| 指标 | 要求 | 说明 |
|------|------|------|
| 页面加载时间 | < 3秒 | 首次加载完整页面 |
| API响应时间 | < 2秒 | 大部分API请求 |
| AI分析响应时间 | < 10秒 | AI股票分析 |
| 搜索响应时间 | < 2秒 | 股票搜索 |
| 并发用户数 | ≥ 1000 | 同时在线用户 |
| 数据库查询时间 | < 500ms | 常规查询 |

### 4.2 可用性需求

| 指标 | 要求 | 说明 |
|------|------|------|
| 系统可用性 | > 99.5% | 年度可用性 |
| 数据更新延迟 | < 1秒 | 实时价格更新 |
| 系统恢复时间 | < 5分钟 | 故障后恢复 |
| 平均故障间隔 | > 720小时 | 系统稳定性 |

### 4.3 安全性需求

| 需求 | 说明 |
|------|------|
| 身份认证 | 所有API请求需要认证（JWT） |
| 数据加密 | 敏感数据加密存储（AES-256） |
| 传输加密 | 支持HTTPS协议（TLS 1.2+） |
| 访问控制 | 基于角色的访问控制（RBAC） |
| 审计日志 | 记录关键操作日志 |
| 防注入 | 防止SQL注入和XSS攻击 |
| 密码安全 | 不存储明文密码，使用bcrypt |

### 4.4 可扩展性需求

| 需求 | 说明 |
|------|------|
| 水平扩展 | 支持多实例部署 |
| 数据库扩展 | 支持数据库读写分离 |
| 缓存扩展 | 支持Redis集群 |
| 插件化 | 支持插件化架构 |
| 数据源扩展 | 支持添加新数据源 |
| AI模型扩展 | 支持集成新AI模型 |

### 4.5 可维护性需求

| 需求 | 说明 |
|------|------|
| 代码规范 | 遵循PEP8和ESLint规范 |
| 文档完整 | 提供完整的API文档 |
| 日志记录 | 详细的日志记录 |
| 监控告警 | 系统监控和告警机制 |
| 自动化测试 | 单元测试覆盖率 > 80% |

### 4.6 兼容性需求

| 需求 | 说明 |
|------|------|
| 浏览器兼容 | 支持Chrome、Firefox、Safari、Edge最新版本 |
| 移动端兼容 | 支持响应式设计，适配移动设备 |
| Python版本 | Python 3.8+ |
| 数据库版本 | PostgreSQL 12+ |
| Redis版本 | Redis 6+ |

## 5. 数据需求

### 5.1 数据实体

#### 用户 (User)
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | Integer | 用户ID | 主键，自增 |
| email | String | 邮箱 | 唯一，非空 |
| username | String | 用户名 | 唯一，非空 |
| avatar | String | 头像URL | 可空 |
| created_at | DateTime | 创建时间 | 非空 |
| last_login | DateTime | 最后登录时间 | 可空 |

#### 自选股 (Watchlist)
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | Integer | 自选股ID | 主键，自增 |
| user_id | Integer | 用户ID | 外键，非空 |
| stock_code | String | 股票代码 | 非空 |
| stock_name | String | 股票名称 | 非空 |
| added_at | DateTime | 添加时间 | 非空 |

#### 分析历史 (AnalysisHistory)
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | Integer | 分析ID | 主键，自增 |
| user_id | Integer | 用户ID | 外键，非空 |
| stock_code | String | 股票代码 | 非空 |
| stock_name | String | 股票名称 | 非空 |
| analysis_type | String | 分析类型 | 非空 |
| result | JSON | 分析结果 | 非空 |
| created_at | DateTime | 分析时间 | 非空 |

#### 用户设置 (UserSettings)
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | Integer | 设置ID | 主键，自增 |
| user_id | Integer | 用户ID | 外键，唯一，非空 |
| default_data_source | String | 默认数据源 | 可空 |
| default_kline_period | String | 默认K线周期 | 可空 |
| default_indicators | JSON | 默认技术指标 | 可空 |
| notification_prefs | JSON | 通知偏好 | 可空 |

### 5.2 数据流图

```
用户 -> 前端界面 -> API网关 -> 后端服务 -> 数据源API
                                    ↓
                              数据库/缓存
```

## 6. 接口需求

### 6.1 外部接口

#### Tushare API
- **用途**: 获取股票市场数据
- **协议**: HTTPS
- **认证**: Token认证
- **数据格式**: JSON

#### AKShare API
- **用途**: 获取股票市场数据
- **协议**: HTTPS
- **认证**: 无需认证
- **数据格式**: JSON

#### Auth0 API
- **用途**: 用户认证
- **协议**: OAuth 2.0
- **认证**: OAuth 2.0
- **数据格式**: JSON

#### AI模型API
- **用途**: AI分析
- **协议**: HTTPS
- **认证**: API Key
- **数据格式**: JSON

### 6.2 内部接口

#### REST API
- **协议**: HTTPS
- **认证**: JWT
- **数据格式**: JSON
- **文档**: Swagger UI

#### WebSocket (可选)
- **协议**: WebSocket
- **用途**: 实时数据推送
- **认证**: JWT

## 7. 约束条件

### 7.1 技术约束
- 必须使用FastAPI作为后端框架
- 必须使用React作为前端框架
- 必须使用PostgreSQL作为主数据库
- 必须使用Redis作为缓存
- 必须使用Auth0进行用户认证

### 7.2 业务约束
- 必须遵守相关金融法规
- 必须保护用户隐私数据
- 必须提供准确的市场数据
- 必须明确标注AI分析结果仅供参考

### 7.3 法律约束
- 遵守《网络安全法》
- 遵守《个人信息保护法》
- 遵守《证券法》相关条款

## 8. 验收标准

### 8.1 功能验收
- 所有P0级功能必须完整实现
- 所有功能必须通过测试
- 所有API必须提供文档

### 8.2 性能验收
- 页面加载时间 < 3秒
- API响应时间 < 2秒
- 支持1000并发用户

### 8.3 安全验收
- 通过安全审计
- 无高危安全漏洞
- 敏感数据加密存储

### 8.4 文档验收
- 提供完整的用户文档
- 提供完整的开发文档
- 提供完整的API文档

## 9. 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| v1.0 | 2026-02-09 | 初始版本 | AI Trading Mate Team |
